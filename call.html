<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ð’Ñ‹Ð·Ð¾Ð²</title>
  <style>
    body{font-family:system-ui,-apple-system;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .wrap{text-align:center;padding:24px;max-width:520px}
    button{font-size:22px;padding:16px 22px;border-radius:14px;border:1px solid #ccc;background:#f7f7f7;cursor:pointer}
    .num{margin-top:14px;font-size:14px;opacity:.75;word-break:break-all}
    .raw{margin-top:10px;font-size:12px;opacity:.55;word-break:break-all}
  </style>
</head>
<body>
  <div class="wrap">
    <button id="call">ðŸ“ž Ð’Ñ‹Ð·Ð¾Ð²</button>
    <div class="num" id="numText"></div>
    <div class="raw" id="rawText"></div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const rawP = params.get("p") || "";
    document.getElementById("rawText").textContent = "ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ p: " + rawP;

    // Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ†Ð¸Ñ„Ñ€Ñ‹
    let d = String(rawP).replace(/\D/g, "");

    // ÐŸÑ€Ð¸Ð²Ð¾Ð´Ð¸Ð¼ Ðº 11-Ð·Ð½Ð°Ñ‡Ð½Ð¾Ð¼Ñƒ RU Ð² Ð²Ð¸Ð´Ðµ +7XXXXXXXXXX
    // Ñ‚Ð²Ð¾Ð¹ ÐºÐµÐ¹Ñ: 10 Ñ†Ð¸Ñ„Ñ€ Ð¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ 9
    if (/^9\d{9}$/.test(d)) d = "7" + d;          // 9XXXXXXXXX -> 79XXXXXXXXX
    if (/^8\d{10}$/.test(d)) d = "7" + d.slice(1); // 8XXXXXXXXXX -> 7XXXXXXXXXX

    const phone = d ? ("+" + d) : "";
    document.getElementById("numText").textContent = phone ? ("ÐÐ¾Ð¼ÐµÑ€: " + phone) : "ÐÐ¾Ð¼ÐµÑ€ Ð½Ðµ Ñ€Ð°ÑÐ¿Ð¾Ð·Ð½Ð°Ð½";

    document.getElementById("call").disabled = !phone;
    document.getElementById("call").addEventListener("click", () => {
      location.href = "facetime-audio:" + encodeURIComponent(phone);
    });
  </script>
</body>
</html>
