<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–í—ã–∑–æ–≤</title>
  <style>
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:flex; align-items:center; justify-content:center;
      height:100vh; margin:0; background:#fff;
    }
    .wrap{ text-align:center; padding:24px; max-width:520px; }
    button{
      font-size:22px; padding:16px 22px;
      border-radius:14px; border:1px solid #cfcfcf;
      background:#f7f7f7; cursor:pointer;
    }
    button:active{ transform: translateY(1px); }
    .num{ margin-top:14px; font-size:14px; opacity:.75; word-break:break-all; }
    .hint{ margin-top:10px; font-size:12px; opacity:.6; }
  </style>
</head>
<body>
  <div class="wrap">
    <button id="callBtn">üìû –í—ã–∑–æ–≤</button>
    <div class="num" id="numText"></div>
    <div class="hint">–ï—Å–ª–∏ Safari —Å–ø—Ä–æ—Å–∏—Ç ‚Äî —Ä–∞–∑—Ä–µ—à–∏ –≤—ã–∑–æ–≤.</div>
  </div>

  <script>
    function normalizePhone(rawDigits) {
      // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
      const d = (rawDigits || "").replace(/\D/g, "");

      // –¢–≤–æ–π –∫–µ–π—Å: 10 —Ü–∏—Ñ—Ä, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 9 -> +7XXXXXXXXXX
      if (/^9\d{9}$/.test(d)) return "+7" + d;

      // –ß–∞—Å—Ç—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
      if (/^8\d{10}$/.test(d)) return "+7" + d.slice(1); // 8XXXXXXXXXX -> +7XXXXXXXXXX
      if (/^7\d{10}$/.test(d)) return "+" + d;           // 7XXXXXXXXXX -> +7XXXXXXXXXX
      if (/^\d{11,15}$/.test(d)) return "+" + d;         // –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –±–µ–∑ –ø–ª—é—Å–∞

      // –ï—Å–ª–∏ –Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –Ω–æ–º–µ—Ä ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å (FaceTime –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–∏–Ω—è—Ç—å)
      return d;
    }

    const params = new URLSearchParams(location.search);
    const p = params.get("p") || "";
    const phone = normalizePhone(p);

    const numText = document.getElementById("numText");
    numText.textContent = phone ? ("–ù–æ–º–µ—Ä: " + phone) : "–ù–æ–º–µ—Ä –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω (–¥–æ–±–∞–≤—å ?p=...)";

    const callBtn = document.getElementById("callBtn");
    callBtn.disabled = !phone;

    callBtn.addEventListener("click", () => {
      // –í–ê–ñ–ù–û: facetime-audio = –±–µ–∑ –∫–∞–º–µ—Ä—ã
      location.href = "facetime-audio:" + encodeURIComponent(phone);
    });
  </script>
</body>
</html>
